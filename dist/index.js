!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.oobe=e():t.oobe=e()}(this,function(){return function(t){var e={};function n(r){if(e[r])return e[r].exports;var o=e[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(r,o,function(e){return t[e]}.bind(null,o));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="/dist/",n(n.s=5)}([function(t,e){function n(t){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function r(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var o=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._base={name:e}}var e,o,i;return e=t,(o=[{key:"$systemError",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"$_no_error";throw"$_no_error"!==n&&console.log("error data => ",n),new Error("(☉д⊙)!! Oobe::".concat(this._base.name," => ").concat(t," -> ").concat(e))}},{key:"$verify",value:function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o={};for(var i in e){var s=e[i],u=s[0],a=s[1],c=s[2];u&&null==t[i]&&this.$systemError("verify","Key(".concat(i,") is required")),a&&null!=t[i]&&!a.includes(n(t[i]))&&this.$systemError("verify","Type(".concat(i,"::").concat(n(t[i]),") error, need ").concat(a.join(" or "))),o[i]=t[i]||c}return Object.assign(o,r)}}])&&r(e.prototype,o),i&&r(e,i),t}();t.exports=o},function(t,e){function n(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function r(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=[],r=!0,o=!1,i=void 0;try{for(var s,u=t[Symbol.iterator]();!(r=(s=u.next()).done)&&(n.push(s.value),!e||n.length!==e);r=!0);}catch(t){o=!0,i=t}finally{try{r||null==u.return||u.return()}finally{if(o)throw i}}return n}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function o(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var i=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,i,s;return e=t,s=[{key:"deepClone",value:function(e){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new WeakMap;if(Object(e)!==e)return e;if(e instanceof Set)return new Set(e);if(o.has(e))return o.get(e);var i=e instanceof Date?new Date(e):e instanceof RegExp?new RegExp(e.source,e.flags):Object.create(null);return o.set(e,i),e instanceof Map&&Array.from(e,function(e){var n=r(e,2),s=n[0],u=n[1];i.set(s,t.deepClone(u,o))}),Object.assign.apply(Object,[i].concat(n(Object.keys(e).map(function(n){return function(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}({},n,t.deepClone(e[n],o))}))))}},{key:"mapping",value:function(t,e,n){var r={};if(e)for(var o in n)r[n[o]]=t[o];else for(var i in n)r[i]=t[n[i]];return r}}],(i=null)&&o(e.prototype,i),s&&o(e,s),t}();t.exports=i},function(t,e,n){function r(t){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function o(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function i(t,e){return!e||"object"!==r(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function s(t){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function u(t,e){return(u=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var a=n(0),c=function(t){function e(){var t;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(t=i(this,s(e).call(this,"Rule"))).items={},t}var n,r,c;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&u(t,e)}(e,a),n=e,(r=[{key:"add",value:function(t,e){"function"!=typeof e&&this.$systemError("add","Rule not a function."),this.items[t]&&this.$systemError("add","The name(".concat(t,") already exists.")),this.items[t]=e}},{key:"get",value:function(t){var e=t.split("|"),n=e.shift(),r=this.items[n],o={};null==r&&this.$systemError("get","Form rule list name(".concat(n,") not found."));var i=!0,s=!1,u=void 0;try{for(var a,c=e[Symbol.iterator]();!(i=(a=c.next()).done);i=!0){var f=a.value.split(":");o[f[0]]=void 0===f[1]||f[1]}}catch(t){s=!0,u=t}finally{try{i||null==c.return||c.return()}finally{if(s)throw u}}return function(t){return r.call(this,t,o)}}}])&&o(n.prototype,r),c&&o(n,c),e}();t.exports=c},function(t,e,n){function r(t){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function o(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function i(t,e){return!e||"object"!==r(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function s(t){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function u(t,e){return(u=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var a=n(0),c=function(t){function e(){var t;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(t=i(this,s(e).call(this,"Locale"))).store={"en-us":{}},t.default=t.store["en-us"],t.setLocale("en-us"),t}var n,c,f;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&u(t,e)}(e,a),n=e,(c=[{key:"setLocale",value:function(t){if("string"!=typeof t)return this.$systemError("setLocale","Locale(".concat(t,") not be strung."));this.locale=t,this.messages=this.store[t]}},{key:"add",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";if("object"!==r(t))return this.$systemError("set","Data not a object",t);for(var n in t)for(var o in null==this.store[n]&&(this.store[n]={}),t[n])this.store[n][e+o]=t[n][o]}},{key:"get",value:function(t,e){var n=this.messages[t]||this.default[t]||t;if(e)for(var r in e){var o=new RegExp("{".concat(r,"}"),"g");n=n.replace(o,e[r])}return n}}])&&o(n.prototype,c),f&&o(n,f),e}();t.exports=c},function(t,e,n){var r=n(1);t.exports=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.$helper=r}},function(t,e,n){var r=n(6),o=n(4);r.isSprite=function(t){return t instanceof o},t.exports=r},function(t,e,n){function r(t){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function s(t,e){return!e||"object"!==r(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function u(t){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function a(t,e){return(a=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var c=n(0),f=n(2),l=n(3),h=n(7),y=function(t){function e(){var t;return o(this,e),(t=s(this,u(e).call(this,"Core"))).rule=new f,t.message=new l,t.locale="en-us",t.containers={},t.addContainer("__system__",{sprites:{system:{body:function(){}}}}),t.systemSprite=t.make("__system__","system"),t}var n,r,y;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&a(t,e)}(e,c),n=e,(r=[{key:"addon",value:function(t){var e=this.$verify(t,{name:[!0,["string"]],rules:[!1,["object"],{}],locale:[!1,["object"],{}]}),n="["+e.name+"]";for(var r in e.rules)this.addRule(n+r,e.rules[r]);this.message.add(e.locale,n)}},{key:"refresh",value:function(){var t=this;this.eachContainer(function(e){e.message.setLocale(t.locale)})}},{key:"eachContainer",value:function(t){for(var e in this.containers)t(this.containers[e])}},{key:"setLocale",value:function(t){this.locale=t,this.refresh()}},{key:"addLocale",value:function(t){this.message.add(t)}},{key:"addRule",value:function(t,e){this.rule.add(t,e)}},{key:"getRule",value:function(t){return this.rule.get(t)}},{key:"validate",value:function(t,e){return this.getRule(t).call(this.systemSprite,e)}},{key:"validates",value:function(t,e){var n=this.getRules(e),r=!0,o=!1,i=void 0;try{for(var s,u=n[Symbol.iterator]();!(r=(s=u.next()).done);r=!0){var a=s.value.call(this.systemSprite,t);if(!0!==a)return a}}catch(t){o=!0,i=t}finally{try{r||null==u.return||u.return()}finally{if(o)throw i}}return!0}},{key:"getRules",value:function(t,e){var n=[],r=!0,o=!1,i=void 0;try{for(var s,u=t[Symbol.iterator]();!(r=(s=u.next()).done);r=!0){var a=s.value,c=null;c="function"==typeof a?a:this.getRule(a),e?n.push(c.bind(e)):n.push(c)}}catch(t){o=!0,i=t}finally{try{r||null==u.return||u.return()}finally{if(o)throw i}}return n}},{key:"make",value:function(t,e,n){var r=this.containers[t];return null==r?this.$systemError("make","Container name(".concat(t,") not found.")):r.make(e,n).getUnit()}},{key:"addContainer",value:function(t,e){return this.containers[t]?this.$systemError("addContainer","Name(".concat(t,") already exists.")):(this.containers[t]=new h(this,e),this.refresh(),this.containers[t])}},{key:"getConfigs",value:function(t){return null==this.containers[t]?this.$systemError("getConfigs","Containers name(".concat(t,") not found.")):this.containers[t].getConfigs()}}])&&i(n.prototype,r),y&&i(n,y),e}();t.exports=function t(){var e=this;o(this,t);var n=new y;this.make=n.make.bind(n),this.addon=n.addon.bind(n),this.addRule=n.addRule.bind(n),this.getRules=function(t){return n.getRules(t,n.systemSprite)},this.validate=n.validate.bind(n),this.validates=n.validates.bind(n),this.addLocale=n.addLocale.bind(n),this.setLocale=n.setLocale.bind(n),this.getConfigs=n.getConfigs.bind(n),this.addContainer=function(t,r){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=n.addContainer(t,r),s=i.options.configs;return i.options.install.call(e,s,o)}}},function(t,e,n){function r(t){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function o(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function i(t,e){return!e||"object"!==r(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function s(t){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function u(t,e){return(u=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var a=n(0),c=n(2),f=n(1),l=n(3),h=n(8),y=function(t){function e(t){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=i(this,s(e).call(this,"Container"))).core=t,n.rule=new c,n.message=new l,n.message.add(r.locale||{}),n.options=n.$verify(r,{rules:[!1,["object"],{}],utils:[!1,["object"],{}],states:[!1,["object"],[]],sprites:[!0,["object"]],configs:[!1,["object"],{}],methods:[!1,["object"],{}],install:[!1,["function"],function(){}]}),n.initRules(),n.initSprites(),n}var n,r,y;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&u(t,e)}(e,a),n=e,(r=[{key:"initRules",value:function(){for(var t in this.options.rules)this.rule.add(t,this.options.rules[t])}},{key:"initSprites",value:function(){for(var t in this.spriteBases={},this.options.sprites)this.spriteBases[t]=new h(this,t,this.options.sprites[t])}},{key:"getRule",value:function(t){return"$"===t.slice(0,1)?this.rule.get(t.slice(1)):this.core.getRule(t)}},{key:"getConfigs",value:function(){return f.deepClone(this.options.configs)}},{key:"getMessage",value:function(t,e){return"$"===t.slice(0,1)?this.message.get(t.slice(1),e):this.core.message.get(t,e)}},{key:"make",value:function(t,e){var n=this.spriteBases[t];return null==n?this.$systemError("make","Sprite ".concat(t," not found.")):n.createSprite(e)}}])&&o(n.prototype,r),y&&o(n,y),e}();t.exports=y},function(t,e,n){function r(t){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function o(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function i(t,e){return!e||"object"!==r(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function s(t){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function u(t,e){return(u=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var a=n(0),c=n(9),f=n(10),l=function(t){function e(t,n){var r,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(r=i(this,s(e).call(this,"Sprite"))).name=n,r.container=t,r.options=r.$verify(o,{body:[!0,["function"]],refs:[!1,["object"],{}],rules:[!1,["object"],{}],watch:[!1,["object"],{}],reborn:[!1,["function"],function(t){return t}],origin:[!1,["function"],function(){return this.$body()}],create:[!1,["function"],function(){}],states:[!1,["object"],{}],methods:[!1,["object"],{}],computed:[!1,["object"],{}]}),r.initStates(),r}var n,r,l;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&u(t,e)}(e,a),n=e,(r=[{key:"initStates",value:function(){this.states={};var t=this.container.options.states.concat(["read","create","update","delete"]),e=!0,n=!1,r=void 0;try{for(var o,i=t[Symbol.iterator]();!(e=(o=i.next()).done);e=!0){var s=o.value;this.states[s]=new c(s,this.options.states[s])}}catch(t){n=!0,r=t}finally{try{e||null==i.return||i.return()}finally{if(n)throw r}}}},{key:"createSprite",value:function(t){return new f(this,t)}}])&&o(n.prototype,r),l&&o(n,l),e}();t.exports=l},function(t,e,n){function r(t){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function o(t,e){return!e||"object"!==r(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function i(t){return(i=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function s(t,e){return(s=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var u=n(0),a=function(t){function e(t){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=o(this,i(e).call(this,"States"))).name=t,n.options=n.$verify(r,{fixed:[!1,["object","string"],[]],hidden:[!1,["object","string"],[]],export:[!1,["function"],function(){return this.$toOrigin()}]}),n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&s(t,e)}(e,u),e}();t.exports=a},function(t,e,n){function r(t){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function o(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function i(t,e){return!e||"object"!==r(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function s(t){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function u(t,e){return(u=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var a=n(0),c=n(4),f=n(11),l=n(1),h=function(t){function e(t,n){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(r=i(this,s(e).call(this,"Sprite"))).unit=new c,r.body={},r.refs={},r.soul=null,r.live=!0,r.from=null,r.base=t,r.fixed=[],r.event=new f(r.unit,["ready"]),r.state=null,r.watch=t.options.watch,r.hidden=[],r.options=t.options,r.rawBody="",r.rawData="",r.callback=n?"function"==typeof n?n:function(t){return t(n)}:null,r.propertyNames=[],r.init(),r.distortion("read"),r}var n,r,h;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&u(t,e)}(e,a),n=e,(r=[{key:"getBody",value:function(){var t=l.deepClone(this.body);return this.eachRefs(function(e,n){t[n]=e.getBody()}),t}},{key:"getKeys",value:function(){return this.propertyNames.concat(Object.keys(this.base.options.refs)).concat(Object.keys(this.base.options.computed))}},{key:"getProperty",value:function(t){if(this.propertyNames.includes(t))return this.unit[t];this.$systemError("getProperty","Property name(".concat(t,") not found."))}},{key:"isFixed",value:function(t){return"*"===this.fixed||this.fixed.includes(t)}},{key:"isHidden",value:function(t){return"*"===this.hidden||this.hidden.includes(t)}},{key:"isChange",value:function(){var t=this.rawBody!==JSON.stringify(this.body);return!!t||(this.eachRefs(function(e){if(t=e.isChange())return"_break"}),t)}},{key:"export",value:function(t){var e=null;return t?null==(e=this.base.states[t])&&this.$systemError("export","State(".concat(t,") not found.")):e=this.state,e.options.export.call(this.unit)}},{key:"getUnit",value:function(){return this.unit}},{key:"toOrigin",value:function(){return this.options.origin.call(this.unit)}},{key:"out",value:function(){return!1===this.live&&this.$systemError("out","This Sprite is dead."),this.soul=this.base.createSprite(this.toOrigin()),this.soul.distortion(this.state.name),this.soul.from=this,this.sleep(),this.soul.getUnit()}},{key:"sleep",value:function(){this.live=!1,this.eachRefs(function(t){return t.sleep()})}},{key:"wakeup",value:function(){this.live=!0,this.eachRefs(function(t){return t.wakeup()})}},{key:"revive",value:function(){var t=this.toOrigin();if(!1===this.live&&this.$systemError("revive","This Sprite is dead."),this.from)return this.from.reborn(t),this.dead();this.$systemError("revive","This Sprite is root.")}},{key:"copy",value:function(){var t=this.base.createSprite(this.toOrigin());return t.distortion(this.state.name),t.getUnit()}},{key:"dead",value:function(){if(!1===this.live&&this.$systemError("dead","This Sprite is dead."),this.from){var t=this.from;return this.from.wakeup(),this.from.soul=null,this.from=null,this.sleep(),t}this.$systemError("dead","This Sprite is root.")}},{key:"getRaws",value:function(){return{default:this.options.body(),rawBody:this.rawBody,rawData:this.rawData}}},{key:"reborn",value:function(t){this.wakeup(),this.resetBody(t)}},{key:"reset",value:function(){if(!1===this.live)return this.$systemError("set","This Sprite is dead.");this.resetBody(JSON.parse(this.rawData))}},{key:"resetBody",value:function(t){var e=this.setBody(t);this.eachRefs(function(t,n){t.setBody(e[n])})}},{key:"setBody",value:function(t){var e=this.options.reborn.call(this.unit,t),n=!0,r=!1,o=void 0;try{for(var i,s=this.propertyNames[Symbol.iterator]();!(n=(i=s.next()).done);n=!0){var u=i.value;this.unit[u]=void 0===e[u]?this.unit[u]:e[u]}}catch(t){r=!0,o=t}finally{try{n||null==s.return||s.return()}finally{if(r)throw o}}return e}},{key:"eachRefs",value:function(t){for(var e in this.refs){if("_break"===t(this.refs[e],e))break}}},{key:"distortion",value:function(t){return!1===this.live&&this.$systemError("distortion","This Sprite is dead."),null==this.base.states[t]?this.$systemError("distortion","Name(".concat(t,") not found.")):(this.state=this.base.states[t],this.fixed=this.state.options.fixed,this.hidden=this.state.options.hidden,this.eachRefs(function(e){return e.distortion(t)}),this.getUnit())}},{key:"onReady",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=this.setBody(t);this.rawBody=JSON.stringify(this.body),this.rawData=JSON.stringify(t),this.base.options.create.call(this.getUnit()),this.eachRefs(function(t,n){t.onReady(e[n])}),this.event.emit("ready")}},{key:"init",value:function(){var t=this;this.initUnit(),this.initBody(),this.initComputed(),this.propertyNames=Object.keys(this.body),this.callback&&this.callback(function(e){return t.onReady(e)})}},{key:"initUnit",value:function(){var t=this.base.container;this.unit.$fn=this.getMethods(),this.unit.$on=this.event.on.bind(this.event),this.unit.$meg=t.getMessage.bind(t),this.unit.$out=this.out.bind(this),this.unit.$dead=this.dead.bind(this),this.unit.$copy=this.copy.bind(this),this.unit.$body=this.getBody.bind(this),this.unit.$keys=this.getKeys.bind(this),this.unit.$raws=this.getRaws.bind(this),this.unit.$reset=this.reset.bind(this),this.unit.$rules=this.getRules.bind(this),this.unit.$utils=t.options.utils,this.unit.$ready=!1,this.unit.$revive=this.revive.bind(this),this.unit.$export=this.export.bind(this),this.unit.$status=this.getStatus.bind(this),this.unit.$configs=t.getConfigs(),this.unit.$isFixed=this.isFixed.bind(this),this.unit.$isHidden=this.isHidden.bind(this),this.unit.$toOrigin=this.toOrigin.bind(this),this.unit.$isChange=this.isChange.bind(this),this.unit.$validate=this.validateAll.bind(this),this.unit.$distortion=this.distortion.bind(this)}},{key:"initBody",value:function(){var t=this.options.refs,e=this.options.body.call(this.unit);for(var n in e)this.body[n]=e[n],Object.defineProperty(this.unit,n,{get:this.getDefineProperty("body",n),set:this.setDefineProperty(n)});for(var r in t)this.refs[r]=this.base.container.make(t[r]),Object.defineProperty(this.unit,r,{get:this.getDefineProperty("refs",r),set:this.setDefineProperty(r,!0)})}},{key:"initComputed",value:function(){var t=this.base.options.computed;for(var e in t)Object.defineProperty(this.unit,e,{get:t[e].get?t[e].get.bind(this.unit):function(){},set:t[e].set?t[e].set.bind(this.unit):function(t){}})}},{key:"getMethods",value:function(){var t={},e=this.base.container.options.methods;for(var n in e)t[n]=e[n].bind(this.unit);var r=this.base.options.methods;for(var o in r)t[o]=r[o].bind(this.unit);return t}},{key:"getStatus",value:function(){return{live:this.live,state:this.state.name,fixed:this.fixed.slice(),hidden:this.hidden.slice()}}},{key:"getRules",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=this.getUnit(),r=[],o=this.base.options.rules[t];null==o&&this.$systemError("getRules","Rule name(".concat(t,") not found.")),o=o.concat(e);var i=!0,s=!1,u=void 0;try{for(var a,c=o[Symbol.iterator]();!(i=(a=c.next()).done);i=!0){var f=a.value;"function"==typeof f?r.push(f.bind(n)):r.push(this.base.container.getRule(f).bind(n))}}catch(t){s=!0,u=t}finally{try{i||null==c.return||c.return()}finally{if(s)throw u}}return r}},{key:"validate",value:function(t,e){var n=this.getRules(t,e),r=this.getProperty(t),o=[],i=!0,s=!0,u=!1,a=void 0;try{for(var c,f=n[Symbol.iterator]();!(s=(c=f.next()).done);s=!0){var l=(0,c.value)(r);!0!==l&&(i=!1,o.push(l))}}catch(t){u=!0,a=t}finally{try{s||null==f.return||f.return()}finally{if(u)throw a}}return{success:i,errors:o}}},{key:"validateAll",value:function(){for(var t=Object.keys(this.base.options.rules),e={},n=!0,r=0,o=t;r<o.length;r++){var i=o[r],s=this.validate(i);!1===s.success&&(n=!1),e[i]=s.errors}return this.eachRefs(function(t,r){var o=t.validateAll();!1===o.success&&(n=!1),e[r]=o.errors}),{success:n,errors:e}}},{key:"getDefineProperty",value:function(t,e){var n=this;return"refs"===t?function(){return n.refs[e].unit}:function(){return n.body[e]}}},{key:"setDefineProperty",value:function(t,e){var n=this;return function(r){return!1===n.live?n.$systemError("set","This Sprite is dead."):e?n.$systemError("set","This property(".concat(t,") is protect.")):(n.watch[t]&&n.watch[t].call(n.unit,n.body[t],r),void(n.body[t]=r))}}}])&&o(n.prototype,r),h&&o(n,h),e}();t.exports=h},function(t,e,n){function r(t){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function o(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function i(t,e){return!e||"object"!==r(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function s(t){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function u(t,e){return(u=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var a=n(0),c=function(t){function e(t){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=i(this,s(e).call(this,"Event"))).target=t,n.channels={};var o=!0,u=!1,a=void 0;try{for(var c,f=r[Symbol.iterator]();!(o=(c=f.next()).done);o=!0){var l=c.value;n.addChannel(l)}}catch(t){u=!0,a=t}finally{try{o||null==f.return||f.return()}finally{if(u)throw a}}return n}var n,r,c;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&u(t,e)}(e,a),n=e,(r=[{key:"hasChannel",value:function(t){return!!this.channels[t]}},{key:"addChannel",value:function(t){this.hasChannel(t)?this.$systemError("addChannel","Name(".concat(t,") already exists.")):this.channels[t]=[]}},{key:"on",value:function(t,e){this.hasChannel(t)?this.channels[t].push(e.bind(this.target)):this.$systemError("on","Channel ".concat(t," not found."))}},{key:"emit",value:function(t,e){if(this.hasChannel(t)){var n=this.channels[t],r=!0,o=!1,i=void 0;try{for(var s,u=n[Symbol.iterator]();!(r=(s=u.next()).done);r=!0){(0,s.value)(e)}}catch(t){o=!0,i=t}finally{try{r||null==u.return||u.return()}finally{if(o)throw i}}}else this.$systemError("on","Channel ".concat(t," not found."))}}])&&o(n.prototype,r),c&&o(n,c),e}();t.exports=c}])});