<body>
    <div id="app">
        <div>{{ s.name }}</div>
        <div>{{ s.$ready }}</div>
        <div>{{ s.$fixed }}</div>
        <div>{{ s.count }}</div>
        <div>{{ s.mix }}</div>
        <div>{{ s.$state }}</div>
        <div>fix:{{ s.$isFixed('name') }}</div>
        <div>{{ s.attributes.sub }}</div>
    </div>
</body>

<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
<script src="../dist/index.js"></script>

<script>
    let data = {
        'Username': 'admin',
        'UserAttributes': [
            {
                'Name': 'sub',
                'Value': 'aaaaaaa-aaaaaaa-aaaaaaa-aaaaaaa-aaaaaaa'
            },
            {
                'Name': 'email_verified',
                'Value': 'true'
            },
            {
                'Name': 'name',
                'Value': 'admin'
            },
            {
                'Name': 'phone_number_verified',
                'Value': 'true'
            },
            {
                'Name': 'phone_number',
                'Value': '+886000000000'
            },
            {
                'Name': 'email',
                'Value': 'admin@gmail.com'
            }
        ],
        'UserCreateDate': '2019-04-21T09:07:48.877Z',
        'UserLastModifiedDate': '2019-04-21T09:12:59.962Z',
        'Enabled': true,
        'UserStatus': 'CONFIRMED'
    }

    let user = {
        body() {
            return {
                name: '',
                count: 0,
            }
        },

        refs: {
            attributes: 'attributes'
        },

        rules: {},

        reborn(rawData) {
            return {
                name: rawData['Username'],
                attributes: rawData['UserAttributes']
            }
        },

        create() {},

        origin() {
            return {
                Username: this.name,
                UserAttributes: this.attributes.$toOrigin()
            }
        },

        computed: {
            mix: {
                get() {
                    return this.name + this.count
                },
                set(v) {
                    this.name = v
                }
            }
        },

        watch: {
            name() {
                this.count += 1
            }
        },

        methods: {
            getSubId() {
                return this.attributes.sub
            }
        },

        states: {
            create: {
                fixed: ['name']
            }
        }
    }
    let attributes = {
        body() {
            return {
                'sub': '',
                'name': '',
                'email': '',
                'phone_number': ''
            }
        },

        reborn(rawData) {
            let target = []
            for (let attr of rawData) {
                target[attr.Name] = attr.Value
            }
            return target
        },

        origin() {
            let body = this.$body()
            let target = []
            for (let key in body) {
                target.push({ Name: key, Value: body[key] })
            }
            return target
        },

        methods: {},

        distortion: {}
    }

    let container = {
        sprites: {
            user,
            attributes
        },

        locale: {},

        install(configs, options) {},

        utils: {},

        configs: {},

        methods: {},

        states: [],

        rules: {}
    }

    var core = new oobe()
        core.join('test', container)
    var app = new Vue({
        el: '#app',
        data() {
            return {
                s: core.make('test', 'user', (f) => {
                    setTimeout(() => {
                        f(data)
                    }, 1000)
                })
            }
        },
        mounted() {
            window.v = this
        }
    })
</script>